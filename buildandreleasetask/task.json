{
    "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
    "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "name": "Sec1APISecurity",
    "friendlyName": "Sec1 API Security Scanner",
    "description": "Sec1 API Security Scanner offers comprehensive scanning capabilities, allowing you to detect vulnerabilities in FOSS repositories and perform SAST scans on source code",
    "helpMarkDown": "",
    "category": "Utility",
    "author": "Sec1",
    "version": {
        "Major": 1,
        "Minor": 4,
        "Patch": 0
    },
    "instanceNameFormat": "Sec1 API Security",
    "groups": [
        {
            "name": "scanOptions",
            "displayName": "Scan Options",
            "isExpanded": true
        },
        {
            "name": "thresholdCheckGroup",
            "displayName": "Threshold Check",
            "isExpanded": false
        },
        {
            "name": "deploymentOptions",
            "displayName": "Deployment Options",
            "isExpanded": false
        },
        {
            "name": "apiScanOptions",
            "displayName": "API Scan Options",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "serviceConnection",
            "type": "connectedService:Generic",
            "label": "Sec1 API Key",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Choose service connection for Sec1 API Key"
        },
        {
            "name": "enableSCA",
            "type": "boolean",
            "label": "Enable SCA Scan",
            "groupName": "scanOptions",
            "defaultValue": true,
            "required": true,
            "helpMarkDown": "Check this box to enable Software Composition Analysis (SCA) scan"
        },
        {
            "name": "enableSAST",
            "type": "boolean",
            "label": "Enable SAST Scan",
            "groupName": "scanOptions",
            "defaultValue": true,
            "required": true,
            "helpMarkDown": "Check this box to enable Static Application Security Testing (SAST) scan"
        },
        {
            "name": "packagePath",
            "type": "filePath",
            "label": "Enter location of package file",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Location of pom.xml or package.json or package-lock.json"
        },
        {
            "name": "thresholdCheck",
            "type": "boolean",
            "label": "Enable the Threshold Check",
            "groupName": "thresholdCheckGroup",
            "defaultValue": false,
            "helpMarkDown": "Check this box to enable the Threshold Check in your pipeline and it will fail if vulnerability threshold level crosses.",
            "required": false
        },
        {
            "name": "critical",
            "type": "string",
            "label": "Enter a threshold value for Critical",
            "groupName": "thresholdCheckGroup",
            "required": false,
            "helpMarkDown": "Enter a threshold value for Critical"
        },
        {
            "name": "high",
            "type": "string",
            "label": "Enter a threshold value for High",
            "groupName": "thresholdCheckGroup",
            "required": false,
            "helpMarkDown": "Enter a threshold value for High"
        },
        {
            "name": "medium",
            "type": "string",
            "label": "Enter a threshold value for Medium",
            "groupName": "thresholdCheckGroup",
            "required": false,
            "helpMarkDown": "Enter a threshold value for Medium"
        },
        {
            "name": "low",
            "type": "string",
            "label": "Enter a threshold value for Low",
            "groupName": "thresholdCheckGroup",
            "required": false,
            "helpMarkDown": "Enter a threshold value for low"
        },
        {
            "name": "enableDeployment",
            "type": "boolean",
            "label": "Enable Deployment",
            "groupName": "deploymentOptions",
            "defaultValue": false,
            "required": false,
            "helpMarkDown": "Enable application deployment after security scans pass"
        },
        {
            "name": "deploymentType",
            "type": "pickList",
            "label": "Deployment Type",
            "groupName": "deploymentOptions",
            "defaultValue": "docker",
            "required": false,
            "options": {
                "docker": "Docker Container",
                "python-direct": "Direct Python App",
                "script": "Remote Script Deployment",
                "custom": "Custom Deployment Script"
            },
            "visibleRule": "enableDeployment = true",
            "helpMarkDown": "Choose the deployment strategy"
        },
        {
            "name": "targetEnvironment",
            "type": "pickList",
            "label": "Target Environment",
            "groupName": "deploymentOptions",
            "defaultValue": "gcp-vm",
            "required": false,
            "options": {
                "gcp-vm": "GCP Compute Engine",
                "gcp-cloudrun": "GCP Cloud Run",
                "azure-webapp": "Azure Web App",
                "custom": "Custom Environment"
            },
            "visibleRule": "enableDeployment = true",
            "helpMarkDown": "Select target deployment environment"
        },
        {
            "name": "customDeploymentScript",
            "type": "multiLine",
            "label": "Custom Deployment Script",
            "groupName": "deploymentOptions",
            "required": false,
            "visibleRule": "deploymentType = custom",
            "helpMarkDown": "Shell commands to execute for custom deployment. Use environment variable SEC1_APP_URL to set the deployed application URL for API scanning.",
            "properties": {
                "resizable": true,
                "rows": "5"
            }
        },
        {
            "name": "gcpProjectId",
            "type": "string",
            "label": "GCP Project ID",
            "groupName": "deploymentOptions",
            "required": false,
            "visibleRule": "targetEnvironment = gcp-vm || targetEnvironment = gcp-cloudrun",
            "helpMarkDown": "Google Cloud Project ID"
        },
        {
            "name": "gcpZone",
            "type": "string",
            "label": "GCP Zone",
            "groupName": "deploymentOptions",
            "defaultValue": "us-central1-a",
            "required": false,
            "visibleRule": "targetEnvironment = gcp-vm",
            "helpMarkDown": "Google Cloud Compute Engine zone"
        },
        {
            "name": "gcpVmName",
            "type": "string",
            "label": "GCP VM Instance Name",
            "groupName": "deploymentOptions",
            "required": false,
            "visibleRule": "targetEnvironment = gcp-vm",
            "helpMarkDown": "Name of the GCP VM instance to deploy to"
        },
        {
            "name": "enableApiScan",
            "type": "boolean",
            "label": "Enable API Scanning",
            "groupName": "apiScanOptions",
            "defaultValue": false,
            "required": false,
            "helpMarkDown": "Trigger API security scan after deployment completes"
        },
        {
            "name": "apiScanConfigId",
            "type": "string",
            "label": "API Scan Configuration ID",
            "groupName": "apiScanOptions",
            "required": false,
            "visibleRule": "enableApiScan = true",
            "helpMarkDown": "Configuration ID from Sec1 platform for API scanning"
        },
        {
            "name": "apiScanMode",
            "type": "pickList",
            "label": "API Scan Mode",
            "groupName": "apiScanOptions",
            "defaultValue": "async",
            "required": false,
            "options": {
                "async": "Asynchronous (Fire and forget)",
                "sync": "Synchronous (Wait for completion)"
            },
            "visibleRule": "enableApiScan = true",
            "helpMarkDown": "Choose whether to wait for API scan completion or trigger and continue"
        },
        {
            "name": "apiScanTimeout",
            "type": "string",
            "label": "API Scan Timeout (minutes)",
            "groupName": "apiScanOptions",
            "defaultValue": "10",
            "required": false,
            "visibleRule": "enableApiScan = true && apiScanMode = sync",
            "helpMarkDown": "Maximum time to wait for synchronous API scan completion"
        },
        {
            "name": "failOnDeploymentError",
            "type": "boolean",
            "label": "Fail on Deployment Error",
            "groupName": "deploymentOptions",
            "defaultValue": true,
            "required": false,
            "helpMarkDown": "Whether to fail the pipeline if deployment encounters an error"
        },
        {
            "name": "continueOnSecurityFailure",
            "type": "boolean",
            "label": "Continue on Security Scan Failure",
            "groupName": "scanningOptions",
            "defaultValue": false,
            "required": false,
            "helpMarkDown": "Whether to continue pipeline if security scans fail threshold checks"
        },
        {
            "name": "failOnApiScanError",
            "type": "boolean",
            "label": "Fail on API Scan Error",
            "groupName": "apiScanOptions",
            "defaultValue": false,
            "required": false,
            "helpMarkDown": "Whether to fail the pipeline if API scan encounters an error"
        }
    ],
    "execution": {
        "Node16": {
            "target": "index.js"
        }
    }
}